<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8"/>
    <title>PortOne V2 Sample Payment</title>
    <script src="https://cdn.portone.io/v2/browser-sdk.js"></script>
    <script th:inline="javascript">
        const portOneStoreId = /*[[${portOneStoreId}]]*/ "";
        const portOneChannelKey = /*[[${portOneChannelKey}]]*/ "";

        async function requestPay() {
            if (!window.PortOne) {
                alert("PortOne SDK 로드에 실패했습니다.");
                return;
            }

            if (!portOneStoreId || !portOneChannelKey) {
                alert("PORTONE_STORE_ID / PORTONE_CHANNEL_KEY 설정이 필요합니다.");
                return;
            }

            try {
                const response = await PortOne.requestPayment({
                    storeId: portOneStoreId,
                    channelKey: portOneChannelKey,
                    paymentId: "order-" + Date.now(),
                    orderName: "당근 10kg",
                    totalAmount: 200,
                    currency: "CURRENCY_KRW",
                    payMethod: "CARD",
                    customer: {
                        fullName: "홍길동",
                        email: "gildong@gmail.com",
                        phoneNumber: "010-4242-4242"
                    }
                });

                // 실패 응답: response.code / response.message
                if (response.code != null) {
                    alert("결제 실패: " + response.message);
                    return;
                }

                // 성공 응답 예: response.paymentId, response.transactionId
                // 서버 검증 API 호출 시 transactionId를 함께 전달
                alert("결제 요청 성공. 서버 검증을 진행하세요.");
                console.log(response);
            } catch (error) {
                alert("결제 요청 중 오류가 발생했습니다.");
                console.error(error);
            }
        }
    </script>
</head>
<body>
<button type="button" onclick="requestPay()">결제하기</button>
</body>
</html>
